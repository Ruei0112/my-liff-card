{\rtf1\ansi\ansicpg950\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;\f1\fnil\fcharset0 HelveticaNeue;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 <!DOCTYPE html>\
<html lang="zh-TW">\
<head>\
    <meta charset="UTF-8">\
    <meta name="viewport" content="width=device-width, initial-scale=1.0">\
    <title>\uc0\u38598 \u40670 \u21345 </title>\
    <script src="https://cdn.tailwindcss.com"></script>\
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>\
    <style>\
        body \{ font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; \}\
        .loader \{ border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 2s linear infinite; \}\
        @keyframes spin \{ 0% \{ transform: rotate(0deg); \} 100% \{ transform: rotate(360deg); \} \}\
    </style>\
</head>\
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">\
\
    <div class="w-full max-w-md bg-white rounded-3xl shadow-xl overflow-hidden flex flex-col relative border border-gray-100 p-6 text-center">\
        \
        <div class="flex flex-col items-center mt-4">\
            <img id="userAvatar" src="https://via.placeholder.com/150" class="w-24 h-24 rounded-full border-4 border-green-400 object-cover" />\
            <h1 id="userName" class="mt-4 text-2xl font-bold text-gray-800">\uc0\u36617 \u20837 \u20013 ...</h1>\
        </div>\
\
        <div class="flex flex-col items-center py-6">\
            <span class="text-sm text-gray-500 font-medium">\uc0\u30446 \u21069 \u40670 \u25976 </span>\
            <span id="pointsDisplay" class="text-8xl font-black text-green-500">--</span>\
            <p class="text-xs text-gray-400 mt-2">\uc0\u27599 \u26376  1 \u34399 \u33258 \u21205 \u37325 \u32622 </p>\
        </div>\
\
        <label id="uploadBtn" class="block w-full py-4 px-6 rounded-full text-center font-bold text-white shadow-lg cursor-pointer bg-gray-800 hover:bg-black transition-all active:scale-95">\
            <span>\uc0\u55357 \u56568  \u19978 \u20659 \u25171 \u21345 \u25130 \u22294 </span>\
            <input type="file" accept="image/*" class="hidden" onchange="handleFileUpload(this)" />\
        </label>\
\
        <p id="statusText" class="text-sm text-gray-500 mt-4 h-6"></p>\
    </div>\
\
    <script>\
        // ==========================================\
        // \uc0\u55357 \u56628  \u35531 \u25226 \u20320 \u22312 \u31532 \u19968 \u37096 \u25343 \u21040 \u30340 \u32178 \u22336 \u36028 \u22312 \u19979 \u38754 \u38617 \u24341 \u34399 \u35041 \u38754 \
        // ==========================================\
        const BACKEND_URL = "
\f1\fs26 https://script.google.com/macros/s/AKfycbwVb14LgVvfsmiYVP2bKMo0UWfZJed4I1q89aSHcAjRx6PIzjbrEq7uBsmmZZj1Ye0H8w/exec
\f0\fs24 "; \
\
        // \uc0\u55357 \u57314  \u35531 \u25226 \u20320 \u30340  LIFF ID \u36028 \u22312 \u36889 \u35041  (\u31561 \u19968 \u19979 \u31532  3 \u27493 \u26371 \u25343 \u21040 \u65292 \u29694 \u22312 \u20808 \u30041 \u31354 \u25110 \u22635 \u23531 )\
        const MY_LIFF_ID = "2008794893-JBgTcY3w"; \
        // ==========================================\
\
        let currentUserId = "";\
        let currentUserName = "\uc0\u28204 \u35430 \u29992 \u25142 ";\
\
        // 1. \uc0\u21021 \u22987 \u21270  LINE LIFF\
        async function initApp() \{\
            try \{\
                // \uc0\u22914 \u26524 \u26377 \u22635  LIFF ID\u65292 \u23601 \u22039 \u35430 \u36899 \u32218  LINE\
                if (MY_LIFF_ID) \{\
                    await liff.init(\{ liffId: MY_LIFF_ID \});\
                    if (liff.isLoggedIn()) \{\
                        const profile = await liff.getProfile();\
                        currentUserId = profile.userId;\
                        currentUserName = profile.displayName;\
                        document.getElementById('userAvatar').src = profile.pictureUrl;\
                        document.getElementById('userName').innerText = currentUserName;\
                    \} else \{\
                        liff.login(); // \uc0\u24375 \u21046 \u30331 \u20837 \
                        return;\
                    \}\
                \} else \{\
                    // \uc0\u22914 \u26524 \u27794 \u22635  ID (\u28204 \u35430 \u27169 \u24335 )\u65292 \u38568 \u27231 \u29986 \u29983 \u19968 \u20491 \u36523 \u20998 \
                    if(!localStorage.getItem('mockId')) \{\
                        localStorage.setItem('mockId', 'user_' + Math.floor(Math.random()*9999));\
                    \}\
                    currentUserId = localStorage.getItem('mockId');\
                    document.getElementById('userName').innerText = currentUserName + " (\uc0\u28204 \u35430 \u27169 \u24335 )";\
                \}\
                \
                // \uc0\u21462 \u24471 \u40670 \u25976 \
                fetchPoints();\
\
            \} catch (err) \{\
                alert("LIFF \uc0\u21021 \u22987 \u21270 \u22833 \u25943 : " + err);\
            \}\
        \}\
\
        // 2. \uc0\u26597 \u35426 \u40670 \u25976 \
        function fetchPoints() \{\
            document.getElementById('statusText').innerText = "\uc0\u27491 \u22312 \u21516 \u27493 \u38642 \u31471 \u36039 \u26009 ...";\
            \
            // \uc0\u20351 \u29992 \u29305 \u27530 \u30340  fetch \u26041 \u24335 \u20358 \u37197 \u21512  Google Apps Script\
            const form = new FormData();\
            form.append('data', JSON.stringify(\{ \
                action: 'getPoints', \
                userId: currentUserId, \
                userName: currentUserName \
            \}));\
\
            // Google Apps Script \uc0\u38656 \u35201 \u29992  text/plain \u30332 \u36865  JSON\
            fetch(BACKEND_URL, \{\
                method: 'POST',\
                body: JSON.stringify(\{ \
                    action: 'getPoints', \
                    userId: currentUserId, \
                    userName: currentUserName \
                \})\
            \})\
            .then(res => res.json())\
            .then(data => \{\
                if (data.success) \{\
                    document.getElementById('pointsDisplay').innerText = data.points;\
                    document.getElementById('statusText').innerText = "\uc0\u36039 \u26009 \u21516 \u27493 \u23436 \u25104 ";\
                \}\
            \})\
            .catch(err => \{\
                console.error(err); \
                // \uc0\u24573 \u30053 \u36328 \u22495 \u37679 \u35492 \u65292 \u22240 \u28858  GAS\u26377 \u26178 \u22238 \u20659 \u26371 \u34987 \u25803 \u65292 \u20294 \u23526 \u38555 \u19978 \u26377 \u22519 \u34892 \
            \});\
        \}\
\
        // 3. \uc0\u19978 \u20659 \u22294 \u29255 \u20006 \u23529 \u26680 \
        function handleFileUpload(input) \{\
            if (!input.files || !input.files[0]) return;\
            \
            const file = input.files[0];\
            const reader = new FileReader();\
            \
            // \uc0\u35722 \u26356 \u25353 \u37397 \u29376 \u24907 \
            const btn = document.getElementById('uploadBtn');\
            const originalText = btn.innerHTML;\
            btn.innerHTML = `<div class="inline-block loader mr-2"></div> AI \uc0\u27491 \u22312 \u23529 \u26680 \u20013 ...`;\
            btn.style.backgroundColor = "#9CA3AF"; // \uc0\u28784 \u33394 \
            btn.style.pointerEvents = "none"; // \uc0\u31105 \u27490 \u40670 \u25802 \
\
            reader.onload = function(e) \{\
                const base64 = e.target.result;\
\
                fetch(BACKEND_URL, \{\
                    method: 'POST',\
                    body: JSON.stringify(\{\
                        action: 'verifyImage',\
                        userId: currentUserId,\
                        userName: currentUserName,\
                        imageBase64: base64\
                    \})\
                \})\
                .then(res => res.json())\
                .then(result => \{\
                    if (result.success) \{\
                        alert("\uc0\u55356 \u57225  \u24685 \u21916 \u65281 " + result.message);\
                        // \uc0\u20171 \u38754 \u21152  1 \u20998  (\u27138 \u35264 \u26356 \u26032 )\
                        let nowPoints = parseInt(document.getElementById('pointsDisplay').innerText);\
                        if(isNaN(nowPoints)) nowPoints = 0;\
                        document.getElementById('pointsDisplay').innerText = nowPoints + 1;\
                    \} else \{\
                        alert("\uc0\u10060  \u22833 \u25943 \u65306 " + result.message);\
                    \}\
                \})\
                .catch(err => \{\
                    alert("\uc0\u36899 \u32218 \u37679 \u35492 \u65292 \u35531 \u31245 \u24460 \u20877 \u35430 ");\
                \})\
                .finally(() => \{\
                    // \uc0\u24674 \u24489 \u25353 \u37397 \
                    btn.innerHTML = originalText;\
                    btn.style.backgroundColor = "#1F2937";\
                    btn.style.pointerEvents = "auto";\
                    input.value = ""; // \uc0\u28165 \u31354 \u27284 \u26696 \u36984 \u25799 \
                \});\
            \};\
            reader.readAsDataURL(file);\
        \}\
\
        // \uc0\u21855 \u21205 \u31243 \u24335 \
        window.onload = initApp;\
    </script>\
</body>\
</html>}
